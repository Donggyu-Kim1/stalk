<!-- stocks/templates/stocks/search.html -->
{% extends 'base.html' %}

{% block content %}
<h1>주식 검색</h1>
<input type="text" id="search-input" placeholder="회사 이름 입력">
<div id="search-results"></div>

<script>
document.getElementById('search-input').addEventListener('input', debounce(function(e) {
    const query = e.target.value;
    if (query.length > 2) {
        fetch(`/stocks/search/?query=${encodeURIComponent(query)}`)
            .then(response => response.json())
            .then(data => {
                const resultsDiv = document.getElementById('search-results');
                if (data.error) {
                    resultsDiv.innerHTML = `<p>Error: ${data.error}</p>`;
                } else {
                    resultsDiv.innerHTML = `
                        <p>Symbol: ${data.symbol}</p>
                        <p>Name: ${data.name}</p>
                        <p>Current Price: ${data.current_price} ${data.currency}</p>
                        <a href="/stocks/${data.symbol}/">View Details</a>
                        <a href="/stocks/${data.symbol}/news/">News</a>
                        <a href="/stocks/${data.symbol}/chart/">Chart</a>
                        <a href="/stocks/${data.symbol}/financials/">Financials</a>
                    `;
                }
            });
    }
}, 300));

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}
</script>
{% endblock %}